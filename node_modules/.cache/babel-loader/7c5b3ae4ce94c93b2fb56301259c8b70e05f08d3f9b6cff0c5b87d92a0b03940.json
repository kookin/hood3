{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ArrayCompositeTreeView = void 0;\nconst persistent_merkle_tree_1 = require(\"@chainsafe/persistent-merkle-tree\");\nconst abstract_1 = require(\"./abstract\");\nclass ArrayCompositeTreeView extends abstract_1.TreeView {\n  constructor(type, tree) {\n    super();\n    this.type = type;\n    this.tree = tree;\n  }\n  /**\n   * Number of elements in the array. Equal to the Uint32 value of the Tree's length node\n   */\n  get length() {\n    return this.type.tree_getLength(this.tree.rootNode);\n  }\n  /**\n   * Returns the View's Tree rootNode\n   */\n  get node() {\n    return this.tree.rootNode;\n  }\n  /**\n   * Get element at `index`. Returns a view of the Composite element type\n   */\n  get(index) {\n    // TODO: Optimize without bitstring\n    const gindex = persistent_merkle_tree_1.toGindexBitstring(this.type.depth, index);\n    const subtree = this.tree.getSubtree(gindex);\n    return this.type.elementType.getView(subtree);\n  }\n  /**\n   * Get element at `index`. Returns a view of the Composite element type.\n   * DOES NOT PROPAGATE CHANGES: use only for reads and to skip parent references.\n   */\n  getReadonly(index) {\n    // TODO: Optimize without bitstring\n    const gindex = persistent_merkle_tree_1.toGindexBitstring(this.type.depth, index);\n    // tree.getSubtree but without the hook\n    const subtree = new persistent_merkle_tree_1.Tree(this.tree.getNode(gindex));\n    return this.type.elementType.getView(subtree);\n  }\n  /**\n   * Set Composite element type `view` at `index`\n   */\n  set(index, view) {\n    const length = this.length;\n    if (index >= length) {\n      throw Error(`Error setting index over length ${index} > ${length}`);\n    }\n    const node = this.type.elementType.commitView(view);\n    this.tree.setNodeAtDepth(this.type.depth, index, node);\n  }\n  /**\n   * Returns an array of views of all elements in the array, from index zero to `this.length - 1`.\n   * The returned views don't have a parent hook to this View's Tree, so changes in the returned views won't be\n   * propagated upwards. To get linked element Views use `this.get()`\n   */\n  getAllReadonly() {\n    const length = this.length;\n    const chunksNode = this.type.tree_getChunksNode(this.node);\n    const nodes = persistent_merkle_tree_1.getNodesAtDepth(chunksNode, this.type.chunkDepth, 0, length);\n    const views = new Array(length);\n    for (let i = 0; i < length; i++) {\n      // TODO: Optimize\n      views[i] = this.type.elementType.getView(new persistent_merkle_tree_1.Tree(nodes[i]));\n    }\n    return views;\n  }\n  /**\n   * Returns an array of values of all elements in the array, from index zero to `this.length - 1`.\n   * The returned values are not Views so any changes won't be propagated upwards.\n   * To get linked element Views use `this.get()`\n   */\n  getAllReadonlyValues() {\n    const length = this.length;\n    const chunksNode = this.type.tree_getChunksNode(this.node);\n    const nodes = persistent_merkle_tree_1.getNodesAtDepth(chunksNode, this.type.chunkDepth, 0, length);\n    const values = new Array(length);\n    for (let i = 0; i < length; i++) {\n      values[i] = this.type.elementType.tree_toValue(nodes[i]);\n    }\n    return values;\n  }\n}\nexports.ArrayCompositeTreeView = ArrayCompositeTreeView;","map":{"version":3,"names":["persistent_merkle_tree_1","require","abstract_1","ArrayCompositeTreeView","TreeView","constructor","type","tree","length","tree_getLength","rootNode","node","get","index","gindex","toGindexBitstring","depth","subtree","getSubtree","elementType","getView","getReadonly","Tree","getNode","set","view","Error","commitView","setNodeAtDepth","getAllReadonly","chunksNode","tree_getChunksNode","nodes","getNodesAtDepth","chunkDepth","views","Array","i","getAllReadonlyValues","values","tree_toValue","exports"],"sources":["../../src/view/arrayComposite.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}